# n8n Docker 环境变量配置示例 - Mac M芯片专用
# 复制此文件为 .env 并根据需要修改配置

# ===========================================
# 基础配置
# ===========================================

# n8n 访问端口 (对外端口)
N8N_PORT=8967

# n8n 主机地址 (通常保持默认)
N8N_HOST=0.0.0.0

# n8n 协议 (http 或 https)
N8N_PROTOCOL=http

# Webhook URL (用于接收外部Webhook)
WEBHOOK_URL=http://localhost:8967

# 时区设置
GENERIC_TIMEZONE=Asia/Shanghai

# ===========================================
# 数据库配置 (完整方案)
# ===========================================

# PostgreSQL 配置
POSTGRES_DB=n8n
POSTGRES_USER=n8n_user
POSTGRES_PASSWORD=n8n_secure_password_2024

# 数据库连接配置
DB_TYPE=postgresdb
DB_POSTGRESDB_HOST=postgres
DB_POSTGRESDB_PORT=5432
DB_POSTGRESDB_DATABASE=n8n
DB_POSTGRESDB_USER=n8n_user
DB_POSTGRESDB_PASSWORD=n8n_secure_password_2024
DB_POSTGRESDB_SCHEMA=public

# ===========================================
# Redis 配置 (完整方案)
# ===========================================

# Redis 密码
REDIS_PASSWORD=redis_secure_password_2024

# Redis 连接配置
QUEUE_BULL_REDIS_HOST=redis
QUEUE_BULL_REDIS_PORT=6379
QUEUE_BULL_REDIS_PASSWORD=redis_secure_password_2024

# 执行模式 (regular 或 queue)
EXECUTIONS_MODE=queue

# ===========================================
# 安全配置
# ===========================================

# 是否启用安全Cookie (https环境下设为true)
N8N_SECURE_COOKIE=false

# 是否启用度量指标
N8N_METRICS=true

# 是否启用诊断数据收集
N8N_DIAGNOSTICS_ENABLED=false

# 加密密钥 (生产环境请设置复杂密钥)
# N8N_ENCRYPTION_KEY=your_encryption_key_here

# ===========================================
# 性能配置
# ===========================================

# 生产环境并发限制
N8N_CONCURRENCY_PRODUCTION_LIMIT=10

# 工作流执行数据保留天数
EXECUTIONS_DATA_MAX_AGE=168

# 是否启用执行数据清理
EXECUTIONS_DATA_PRUNE=true

# SQLite 配置 (单容器方案)
DB_SQLITE_ENABLE_WAL=true
DB_SQLITE_VACUUM_ON_STARTUP=true
DB_SQLITE_POOL_SIZE=3

# ===========================================
# Task Runner 配置
# ===========================================

# 是否启用 Task Runner
N8N_RUNNERS_ENABLED=true

# Task Runner 模式 (internal 或 external)
N8N_RUNNERS_MODE=internal

# ===========================================
# 日志配置
# ===========================================

# 日志级别 (error, warn, info, debug)
N8N_LOG_LEVEL=info

# 日志输出方式 (console, file)
N8N_LOG_OUTPUT=console

# ===========================================
# 邮件配置 (可选)
# ===========================================

# 邮件发送模式 (smtp)
# N8N_EMAIL_MODE=smtp

# SMTP 服务器配置
# N8N_SMTP_HOST=smtp.gmail.com
# N8N_SMTP_PORT=587
# N8N_SMTP_USER=your-email@gmail.com
# N8N_SMTP_PASS=your-app-password
# N8N_SMTP_SENDER=your-email@gmail.com
# N8N_SMTP_SSL=true

# ===========================================
# 高级配置
# ===========================================

# 是否启用代理跳数检测
# N8N_PROXY_HOPS=1

# 多主节点设置 (集群环境)
# N8N_MULTI_MAIN_SETUP_ENABLED=false

# 禁用的模块
# N8N_DISABLED_MODULES=insights

# 启用的模块
# N8N_ENABLED_MODULES=insights

# 队列健康检查
# QUEUE_HEALTH_CHECK_ACTIVE=true

# ===========================================
# Docker 配置
# ===========================================

# Docker 项目名称
COMPOSE_PROJECT_NAME=n8n-mac-m1

# Docker 网络子网
DOCKER_SUBNET=172.20.0.0/16

# ===========================================
# 备份配置
# ===========================================

# 备份保留天数
BACKUP_RETENTION_DAYS=30

# 备份目录
BACKUP_DIR=./backups

# 是否启用自动备份
AUTO_BACKUP_ENABLED=true

# 自动备份间隔 (小时)
AUTO_BACKUP_INTERVAL=24

# ===========================================
# 使用说明
# ===========================================

# 1. 复制此文件为 .env: cp .env.example .env
# 2. 根据需要修改配置值
# 3. 重启服务使配置生效

# 注意事项:
# - 生产环境请务必修改默认密码
# - 建议为每个环境使用不同的加密密钥
# - HTTPS 环境下请启用 N8N_SECURE_COOKIE
# - 根据服务器性能调整并发限制